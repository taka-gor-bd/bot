<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Referral History - EarnHub</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <style>
    :root{--primary-color:#6a11cb;--secondary-color:#2575fc;--premium-color:#ff9f0a;--green-color:#34c759;--red-color:#ff3b30;--dark-bg:#0d0d0d;--card-bg:#1c1c1e;--text-primary:#ffffff;--text-secondary:#a1a1aa}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Poppins',-apple-system,sans-serif;background-color:var(--dark-bg);color:var(--text-primary);padding-bottom:90px}
    .container{padding:20px 15px}
    .page-title{font-size:26px;font-weight:700;margin-bottom:20px;text-align:center}
    .summary-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px}
    .stat-card{background-color:var(--card-bg);border-radius:12px;padding:15px 10px;text-align:center}
    .stat-value{font-size:20px;font-weight:700}
    .stat-label{font-size:12px;color:var(--text-secondary);margin-top:4px}
    .list-card{background-color:var(--card-bg);border-radius:12px;padding:15px}
    .search-input{width:100%;padding:10px 12px;background-color:#2c2c2e;border:1px solid #3a3a3c;border-radius:8px;color:var(--text-primary);margin-bottom:10px}
    .referral-item{display:grid;grid-template-columns:1fr auto;align-items:center;padding:12px 10px;border-radius:10px;background-color:#151515;margin-bottom:8px}
    .referral-item .name{font-size:15px;font-weight:600}
    .referral-item .email{font-size:13px;color:var(--text-secondary)}
    .referral-item .meta{font-size:12px;color:var(--text-secondary)}
    .referral-item .points{font-size:14px;font-weight:700;color:var(--green-color)}
    .navigation{position:fixed;bottom:0;left:0;right:0;background-color:#101010;display:flex;justify-content:space-around;padding:10px 0 calc(15px + env(safe-area-inset-bottom));border-top:1px solid #2a2a2a}
    .nav-item{display:flex;flex-direction:column;align-items:center;text-decoration:none;color:var(--text-secondary);flex-grow:1}
    .nav-item.active{color:var(--primary-color)}
    .nav-icon{font-size:24px;margin-bottom:5px}
    .nav-label{font-size:12px;font-weight:500}
  </style>
</head>
<body>
  <div class="container">
    <h1 class="page-title">Referral History</h1>
    <div class="summary-grid">
      <div class="stat-card"><div class="stat-value" id="total-referrals">0</div><div class="stat-label">Total Referrals</div></div>
      <div class="stat-card"><div class="stat-value" id="valid-referrals">0</div><div class="stat-label">Valid Referrals</div></div>
      <div class="stat-card"><div class="stat-value" id="referral-points">0</div><div class="stat-label">Points Earned</div></div>
    </div>
    <div class="list-card">
      <input type="text" id="search" class="search-input" placeholder="Search by name or email" />
      <div id="referral-list"></div>
    </div>
  </div>

  <nav class="navigation">
    <a href="home.html" class="nav-item"><i class="fas fa-home nav-icon"></i><span class="nav-label">Home</span></a>
    <a href="tasks.html" class="nav-item"><i class="fas fa-list-check nav-icon"></i><span class="nav-label">Tasks</span></a>
    <a href="premium.html" class="nav-item"><i class="fas fa-star nav-icon"></i><span class="nav-label">Premium</span></a>
    <a href="wallet.html" class="nav-item"><i class="fas fa-wallet nav-icon"></i><span class="nav-label">Wallet</span></a>
    <a href="profile.html" class="nav-item active"><i class="fas fa-user nav-icon"></i><span class="nav-label">Profile</span></a>
  </nav>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    const firebaseConfig = {
      apiKey: "AIzaSyAOEZ-yOQA0P_ZRHG5ppvz1UpnYGN-MMXM",
      authDomain: "earnhub-a58e5.firebaseapp.com",
      databaseURL: "https://earnhub-a58e5-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "earnhub-a58e5",
      storageBucket: "earnhub-a58e5.firebasestorage.app",
      messagingSenderId: "644080542691",
      appId: "1:644080542691:web:dae120e0f671f991cf36d6",
      measurementId: "G-G7CJZ0BV0K"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const POINTS_PER_REFERRAL = 50;

    const referralListEl = document.getElementById('referral-list');
    const totalReferralsEl = document.getElementById('total-referrals');
    const validReferralsEl = document.getElementById('valid-referrals');
    const referralPointsEl = document.getElementById('referral-points');
    const searchEl = document.getElementById('search');

    let all = [];

    function render(filter='') {
      referralListEl.innerHTML = '';
      const items = all.filter(r=>{
        const t = ((r.name||'') + ' ' + (r.email||'')).toLowerCase();
        return t.includes(filter.toLowerCase());
      });
      if (items.length===0) {
        const empty = document.createElement('div');
        empty.style.color='var(--text-secondary)'; empty.style.fontSize='14px'; empty.style.textAlign='center'; empty.style.padding='8px 0';
        empty.textContent='No referrals found.'; referralListEl.appendChild(empty);
        return;
      }
      items.forEach(r=>{
        const row = document.createElement('div');
        row.className = 'referral-item';
        row.innerHTML = `
          <div>
            <div class="name">${r.name||'Unknown'}</div>
            <div class="email">${r.email||'No email'}</div>
            <div class="meta">${new Date(r.timestamp||Date.now()).toLocaleString()}</div>
          </div>
          <div class="points">+${POINTS_PER_REFERRAL}</div>
        `;
        referralListEl.appendChild(row);
      });
    }
    searchEl.addEventListener('input', ()=> render(searchEl.value));

    onAuthStateChanged(auth, (user)=>{
      if (!user) { window.location.href='login.html'; return; }
      onValue(ref(db, 'users/'+user.uid), (s)=>{
        const d = s.val()||{};
        const refs = d.referrals || {};
        all = Object.values(refs);
        totalReferralsEl.textContent = Object.keys(refs).length;
        validReferralsEl.textContent = Object.keys(refs).length;
        referralPointsEl.textContent = Object.keys(refs).length * POINTS_PER_REFERRAL;
        render(searchEl.value);
      });
    });
  </script>
</body>
</html>